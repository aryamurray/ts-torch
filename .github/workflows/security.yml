name: Security

on:
  pull_request:
    branches:
      - main
  schedule:
    - cron: '0 6 * * 1'
  workflow_dispatch:

jobs:
  dependency-review:
    if: github.event_name == 'pull_request'
    runs-on: ubuntu-latest
    continue-on-error: true
    permissions:
      contents: read
      pull-requests: write
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Dependency review
        uses: actions/dependency-review-action@v4

      - name: Dependency review unavailable notice
        if: failure()
        run: |
          echo "Dependency review is unavailable for this repository (dependency graph likely disabled)."
          echo "Enable dependency graph in repository security settings to enforce this check."
          echo "Continuing because this job is non-blocking."

  audit:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: latest

      - name: Install dependencies
        run: bun install --frozen-lockfile

      - name: Run bun audit
        run: bun audit
